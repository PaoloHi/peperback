@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using Microsoft.AspNetCore.Identity
@model PropiedadesModelTablero


@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager


@{
    ViewData["Title"] = "Rummet / Tablero de propiedades";
    Layout = "_NavUsuarios";
}

<!--Hola-->

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Propiedades</title>
    <link rel="icon" type="image/png" sizes="16x16" href="~/img/imagen-logo/logo_oficial.png">

    <link rel="stylesheet" href="~/css/style_tablero_propiedades.css">
    <link rel="stylesheet" href="~/css/styleGeneral.css" />
    <link rel="stylesheet" href="~/css/estilosGenerales.css" />


</head>




<!--animacion-->
<ul class="circles">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
</ul>




<h4 class="ms-4 tituloVista">Propiedades</h4>
<div class="container-fluid contenedorGeneralBlanco mt-3 " style="margin: 0px 2rem; width: -webkit-fill-available;">




    <!--indicadores y barra de acciones-->
    <div class="container-fluid indicadores_Container mt-3" style="width:fit-content;">

        <!--btn de no publicada | publicada | en proceso | cerrada -->
        <div class="row tab margin-tablinks mx-auto">
            @{
                var NoP = ViewBag.contePropiedadesRevision;
                var PuP = ViewBag.contePropiedadesAprobada;
                var PrP = ViewBag.contePropiedadesEnProceso;
                var CeP = ViewBag.contePropiedadesCerradas;
            }
            <div class="col p-0">
                <button type="button" class="border-0 d-flex tablinks2 changeCard " id="PropiedasesNoPublicadas">
                    <div class="caja-a-b mb-2 mb-xl-0 ">
                        <div class="card-main col-12 mt-2 d-flex align-items-center">
                            <div class="col-6 mt-3 d-flex justify-content-center">


                                <div class=" d-flex justify-content-center">
                                    <p class="size-letter-cards-first ms-2 my-auto">No publicadas</p>
                                </div>
                            </div>
                            <div class="col-6 d-flex justify-content-center">
                                <div class="text-cards d-flex mt-3  indicator-nopublicadas">
                                    <h6 class="mx-auto text-white my-auto size-number-indicator">@NoP</h6>
                                </div>
                            </div>



                        </div>

                    </div>
                </button>
            </div>
            <div class="col p-0">
                <button type="button" class="border-0 d-flex changeCard  tablinks2 " id="PropiedadesPublicadas">
                    <div class="caja-a-b mb-xl-0">
                        <div class="card-main col-12 d-flex align-items-center mt-2">
                            <div class="col-6 mt-3 justify-content-center d-flex">


                                <div class=" d-flex justify-content-center ">
                                    <p class="size-letter-cards-first ms-2 my-auto">Publicadas</p>
                                </div>
                            </div>
                            <div class="col-6  d-flex justify-content-center">
                                <div class="text-cards d-flex mt-3  indicator-publicadas">
                                    <h6 class="mx-auto text-white my-auto size-number-indicator">@PuP</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </button>
            </div>
            <div class="col p-0">
                <button type="button" class="border-0 d-flex tablinks2 changeCard" id="PropiedadesEnProceso">
                    <div class="caja-a-b mx-auto mb-2 mb-xl-0">
                        <div class="card-main col-12 d-flex align-items-center">
                            <div class="col-6 mt-3 justify-content-center d-flex ">


                                <div class=" d-flex justify-content-center">
                                    <p class="size-letter-cards-first ms-2 my-auto">En proceso de entrega</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center col-6">
                                <div class="text-cards d-flex mt-4 indicator-enproceso">
                                    <h6 class="mx-auto text-white my-auto size-number-indicator">@PrP</h6>
                                </div>
                            </div>



                        </div>
                    </div>
                </button>
            </div>
            <div class="col p-0">
                <button type="button" class="changeCardTable border-0 d-flex tablinks2" id="PropiedadesCerradas">
                    <div class="caja-a-b mx-auto mb-2 mb-xl-0">
                        <div class="card-main col-12 d-flex align-items-center">
                            <div class="col-6 mt-3 justify-content-center d-flex ">



                                <div class=" d-flex d-block justify-content-center">
                                    <p class="size-letter-cards-first ms-2 mt-4">Cerradas</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center col-6">
                                <div class="text-cards d-flex mt-3 indicator-cerradas">
                                    <h6 class="mx-auto text-white my-auto size-number-indicator">@CeP</h6>
                                </div>
                            </div>

                        </div>
                    </div>
                </button>
            </div>
        </div>



        <div class="container-fluid px-0 mt-3 mx-auto row row-cols-3 mt-1 responsiveExtraSmall">
            <!--boton de nueva propiedad-->
            <form id="nuevaPropiedadForm" class="d-flex col-lg-3 ">
                <button type="submit" class="row row-cols-2 d-inline-flex btnExperimento p-0 mresponsive" asp-controller="Propiedades" asp-action="NuevaPropiedad">
                    <div class="col-9 suContainGrande text-black" style="font-size: 12.3px;">
                        Nueva propiedad
                    </div>
                    <div class="col-3 subContain">
                        <i class="fa-solid fa-plus icono"></i>
                    </div>
                </button>
            </form>
            <!--buscador y filtros-->
            <div class="d-flex col-lg-7  row row-cols-2 mresponsiveInputSearch">
                <input class="form-control inputs size-search" id="autoComplete" type="search" placeholder="Buscar" aria-label="Search">
                @Html.DropDownListFor(model => model.TPropiedadL, new
                SelectList(ViewBag.TPropiedadL,"IDtipoP","Tipo"), "--Tipo--",new
                {@class="col-1 size-select2 form-control  text-center w-auto selectTipoProp", @id="TipoPropiedadID", required = "required"})
            </div>
            <!--btn excel-->
            <form id="excelTabla" class="d-flex col-lg-2 justify-content-end px-0 ">
                <button id="tablaExcel" class="btn-s ms-1 botonExcel" data-toggle="tooltip" data-placement="bottom" title="Descargar datos a excel" asp-controller="Propiedades" asp-action="ExportarListaPropiedades">
                    <i class="fa-solid fa-file-excel"></i>
                </button>
            </form>
        </div>

    </div>

    <!--Aqui empieza la barra de busqueda-->
    <input id="default" value="NP" class="d-none">
    <input id="controlador" value="Propiedades" class="d-none" />


    <div class="px-0  tabcontent2 mb-3 " id="noPublicadaContent">
        <div class="container-fluid px-0 mx-auto row">
            <div class="col">

                <!--Botones de visualización para ver las tarjetas o la tabla-->
                <div class="tab rounded" id="noCerradasButons">
                    <button id="card" class="tablinks" data-toggle="tooltip" data-placement="right" title="Vista tarjeta" style="background-color:#cccccc">
                        <i class="fa-regular fa-address-card mt-1" style="font-size:20px; color: rgb(71, 71, 71);"></i>
                    </button>



                    <button id="table" class="changeFormat tablinks" data-toggle="tooltip" data-placement="right" title="Vista tabla" >

                        <i class="fa-solid fa-table mt-1" style="font-size:20px; color: rgb(71, 71, 71);"></i>
                    </button>


                </div>

                <!--Botones de visualización para ver las tarjetas o la tabla-->
                <div id="CerradasButons" class="tab  rounded d-none btn-group" role="group" aria-label="Basic radio toggle button group">
                     <button id="venta" class="tablinks3 " onclick="vercontenedor(event, 'Tabla4')" style="background-color:#cccccc"; >Vendidas</button>
                    <button id="renta" class="tablinks3 " onclick="vercontenedor(event, 'Tabla5')">Rentadas</button>

                    
                </div>
                <div id="contenedoPropiedades" class="tabcontent">
                </div>

                @* Modificado por jenny *@
                <nav aria-label="Page navigation example" class="d-flex justify-content-center mt-4">
                    <ul class="pagination" id="paginacion">
                    </ul>
                </nav>
            </div>
        </div>
    </div>

</div>


<script>
    @{
        bool TienePermisos = false;
            @if (SignInManager.IsSignedIn(User) && (!User.IsInRole("Broker") && !User.IsInRole("Finanzas") && !User.IsInRole("Aliado") && !User.IsInRole("Legal") && !User.IsInRole("Propietario") && !User.IsInRole("Propietario") && !User.IsInRole("APJWR") && !User.IsInRole("Fotografia")))
        {
            TienePermisos = true;
        }
        else
        {
            TienePermisos = false;
        }
    }

        window.UsuarioTienepermiso = JSON.parse('@Html.Raw(Json.Serialize(TienePermisos))');

</script>

<script>
    function exportTableToExcel(tableID, filename = '') {
        var downloadLink;
        var dataType = 'application/vnd.ms-excel';
        var tableSelect = document.getElementById(tableID);
        var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

        // Specify file name
        filename = filename ? filename + '.xls' : 'excel_data.xls';

        // Create download link element
        downloadLink = document.createElement("a");

        document.body.appendChild(downloadLink);

        if (navigator.msSaveOrOpenBlob) {
            var blob = new Blob(['ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            // Create a link to the file
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

            // Setting the file name
            downloadLink.download = filename;

            //triggering the function
            downloadLink.click();
        }
    }




    //Para bloquear el boton de la tabla de excel
    const botonBloqueado = document.getElementById('tablaExcel');


    // Escuchar el evento 'submit' del formulario
    document.getElementById("excelTabla").addEventListener("submit", function () {
        // Deshabilitar el botón antes de enviar el formulario
        botonBloqueado.disabled = true;

        setTimeout(() => {
            // Habilita el botón de envío después de que el envío haya terminado
            if (botonBloqueado) {
                botonBloqueado.disabled = false;
            }
        }, 6000);
    });


</script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!--SCRIPTS-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>


<script src="~/js/script.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/assets/js/jquery-2.2.4.min.js" type="text/javascript"></script>


<!--   Core JS Files   -->

<script src="~/assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="~/assets/js/jquery.bootstrap.js" type="text/javascript"></script>


<!--  Plugin for the Wizard -->
<script src="~/assets/js/material-bootstrap-wizard.js"></script>

<!--  More information about jquery.validate here: http://jqueryvalidation.org/	 -->
<script src="~/assets/js/jquery.validate.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
<script src="~/js/script.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/5.0.0/mdb.min.js"></script>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!--- este escript es para el autocompletado

<script src="https://cdn.jsdelivr.net/npm/@@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
<script src="~/js/Filtros.js"></script>

--->

<script src="~/js/paginacionProp.js"></script>
<script src="~/js/propiedadesEli.js"></script>


@{
    string? successMessage = TempData["SuccessMessage"] as string ?? "undefined";


    string? failedMessage = TempData["FailedMessage"] as string ?? "undefined";

}

<script>

    document.addEventListener("DOMContentLoaded", function () {
        console.log('@successMessage');
        console.log('@failedMessage');

        if ('undefined' !== '@successMessage') {
            Swal.fire({
                title: '¡Registro exitoso!',
                html: successMessage,
                icon: 'success',
                confirmButtonText: "Ok",
                customClass: {
                    confirmButton: 'button_confirmacion'
                }
            });
        } else if ('undefined' !== '@failedMessage') {
            Swal.fire({
                icon: 'error',
                title: 'Registro fallido',
                html: 'No se pudo guardar la propiedad, por favor intenta de nuevo o comunícate a <ul class="mx-5 text-center"><li class="text-start"> soporte@rummet.mx </li> <li class="text-start"> vía whatsapp  +52 56 1756 1472 </li>  </ul> .',
                confirmButtonText: "Ok",
                customClass: {
                    confirmButton: 'button_confirmacion'
                }
            });
        }

    });


    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });


    // Get the element with id="defaultOpen" and click on it
    document.querySelector(".tablaCerradasDefault").click();
</script>

<script defer>
    var lazyImages = document.querySelectorAll('.lazy-load');
    var firstImage = lazyImages[0]; // Obtén la primera imagen

    if ('IntersectionObserver' in window) {
        var lazyImageObserver = new IntersectionObserver(function (entries, observer) {
            entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                    var lazyImage = entry.target;
                    lazyImage.src = lazyImage.dataset.src;
                    lazyImage.classList.remove('lazy-load');
                    lazyImageObserver.unobserve(lazyImage);
                }
            });
        });

        // Observa todas las imágenes, excepto la primera
        lazyImages.forEach(function (lazyImage, index) {
            if (index > 0) {
                lazyImageObserver.observe(lazyImage);
            }
        });

        // Carga la primera imagen de inmediato
        if (firstImage) {
            firstImage.src = firstImage.dataset.src;
            firstImage.classList.remove('lazy-load');
        }
    }
</script>

<script>
    function cambiarFondo() {
        // Obtén todos los elementos con la clase 'tablinks'
        var botones = document.getElementsByClassName('tablinks');

        // Itera sobre los botones y cambia el fondo si tienen la clase 'clicked'
        for (var i = 0; i < botones.length; i++) {
            if (botones[i].classList.contains('clicked')) {
                botones[i].style.backgroundColor = '#3498db'; // Puedes cambiar el color aquí
                alert('hola hermosa');
            }
        }
    }
</script>